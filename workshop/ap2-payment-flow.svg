<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 550 630">
  <defs>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#4285f4"/>
      <stop offset="100%" style="stop-color:#34a853"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="550" height="630" fill="#fafafa"/>

  <!-- Header -->
  <rect x="0" y="0" width="550" height="50" fill="url(#headerGrad)"/>
  <text x="275" y="32" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="20" font-weight="bold">AP2 Payment Flow</text>

  <!-- Participants -->
  <g font-family="Arial, sans-serif">
    <!-- User -->
    <rect x="30" y="65" width="80" height="40" rx="6" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" filter="url(#shadow)"/>
    <text x="70" y="82" text-anchor="middle" font-size="16">üë§</text>
    <text x="70" y="98" text-anchor="middle" font-size="10" font-weight="bold">User</text>

    <!-- Shopper Agent -->
    <rect x="150" y="65" width="100" height="40" rx="6" fill="#e8f5e9" stroke="#388e3c" stroke-width="2" filter="url(#shadow)"/>
    <text x="200" y="82" text-anchor="middle" font-size="16">ü§ñ</text>
    <text x="200" y="98" text-anchor="middle" font-size="9" font-weight="bold">Shopper Agent</text>

    <!-- Merchant Agent -->
    <rect x="290" y="65" width="100" height="40" rx="6" fill="#fff3e0" stroke="#f57c00" stroke-width="2" filter="url(#shadow)"/>
    <text x="340" y="82" text-anchor="middle" font-size="16">üè™</text>
    <text x="340" y="98" text-anchor="middle" font-size="9" font-weight="bold">Merchant Agent</text>

    <!-- Payment Processor -->
    <rect x="430" y="65" width="100" height="40" rx="6" fill="#fce4ec" stroke="#c2185b" stroke-width="2" filter="url(#shadow)"/>
    <text x="480" y="82" text-anchor="middle" font-size="16">üí≥</text>
    <text x="480" y="98" text-anchor="middle" font-size="9" font-weight="bold">Payment Proc.</text>
  </g>

  <!-- Vertical lines -->
  <line x1="70" y1="105" x2="70" y2="565" stroke="#ddd" stroke-width="1" stroke-dasharray="4,4"/>
  <line x1="200" y1="105" x2="200" y2="565" stroke="#ddd" stroke-width="1" stroke-dasharray="4,4"/>
  <line x1="340" y1="105" x2="340" y2="565" stroke="#ddd" stroke-width="1" stroke-dasharray="4,4"/>
  <line x1="480" y1="105" x2="480" y2="565" stroke="#ddd" stroke-width="1" stroke-dasharray="4,4"/>

  <!-- Phase 1: Discovery -->
  <rect x="20" y="115" width="430" height="95" rx="4" fill="#e3f2fd" fill-opacity="0.3" stroke="#1976d2" stroke-dasharray="3,3"/>
  <text x="30" y="130" font-family="Arial" font-size="10" fill="#1976d2" font-weight="bold">‚ë† DISCOVERY</text>

  <!-- Step 1 -->
  <text x="135" y="148" text-anchor="middle" font-family="Arial" font-size="9" fill="#333">"Book flight to Paris"</text>
  <line x1="70" y1="155" x2="195" y2="155" stroke="#1976d2" stroke-width="2"/>
  <polygon points="190,151 200,155 190,159" fill="#1976d2"/>

  <!-- Step 2 -->
  <text x="270" y="173" text-anchor="middle" font-family="Arial" font-size="9" fill="#333">Search flights</text>
  <line x1="200" y1="180" x2="335" y2="180" stroke="#388e3c" stroke-width="2"/>
  <polygon points="330,176 340,180 330,184" fill="#388e3c"/>

  <!-- Step 3 -->
  <line x1="340" y1="198" x2="205" y2="198" stroke="#f57c00" stroke-width="2" stroke-dasharray="4,2"/>
  <polygon points="210,194 200,198 210,202" fill="#f57c00"/>
  <text x="270" y="195" text-anchor="middle" font-family="Arial" font-size="9" fill="#333">Flight options</text>

  <!-- Phase 2: Mandate Creation -->
  <rect x="20" y="220" width="430" height="95" rx="4" fill="#fff3e0" fill-opacity="0.3" stroke="#f57c00" stroke-dasharray="3,3"/>
  <text x="30" y="235" font-family="Arial" font-size="10" fill="#f57c00" font-weight="bold">‚ë° MANDATE CREATION</text>

  <!-- Step 4 -->
  <text x="135" y="253" text-anchor="middle" font-family="Arial" font-size="9" fill="#333">"Book FL001"</text>
  <line x1="70" y1="260" x2="195" y2="260" stroke="#1976d2" stroke-width="2"/>
  <polygon points="190,256 200,260 190,264" fill="#1976d2"/>

  <!-- Step 5 -->
  <text x="270" y="278" text-anchor="middle" font-family="Arial" font-size="9" fill="#333">Create mandate</text>
  <line x1="200" y1="285" x2="335" y2="285" stroke="#388e3c" stroke-width="2"/>
  <polygon points="330,281 340,285 330,289" fill="#388e3c"/>

  <!-- Step 6 -->
  <line x1="340" y1="303" x2="205" y2="303" stroke="#f57c00" stroke-width="2" stroke-dasharray="4,2"/>
  <polygon points="210,299 200,303 210,307" fill="#f57c00"/>
  <text x="270" y="300" text-anchor="middle" font-family="Arial" font-size="9" fill="#333">PaymentMandate</text>

  <!-- Phase 3: Authorization -->
  <rect x="20" y="325" width="280" height="130" rx="4" fill="#c8e6c9" stroke="#2e7d32" stroke-width="2"/>
  <text x="30" y="340" font-family="Arial" font-size="10" fill="#2e7d32" font-weight="bold">‚ë¢ AP2 AUTHORIZATION ‚≠ê</text>

  <!-- Arrow from Shopper to User -->
  <text x="135" y="355" text-anchor="middle" font-family="Arial" font-size="8" fill="#388e3c">Request auth</text>
  <line x1="200" y1="362" x2="75" y2="362" stroke="#388e3c" stroke-width="2"/>
  <polygon points="80,358 70,362 80,366" fill="#388e3c"/>

  <!-- Authorization dialog -->
  <rect x="35" y="372" width="145" height="50" rx="4" fill="white" stroke="#2e7d32" stroke-width="1" filter="url(#shadow)"/>
  <text x="107" y="387" text-anchor="middle" font-family="Arial" font-size="9" font-weight="bold" fill="#2e7d32">AUTHORIZE?</text>
  <text x="107" y="400" text-anchor="middle" font-family="Arial" font-size="8" fill="#333">$952.00 ‚Üí flight_merchant</text>
  <rect x="45" y="405" width="40" height="12" rx="2" fill="#4caf50"/>
  <text x="65" y="414" text-anchor="middle" font-family="Arial" font-size="7" fill="white" font-weight="bold">APPROVE</text>
  <rect x="90" y="405" width="40" height="12" rx="2" fill="#f44336"/>
  <text x="110" y="414" text-anchor="middle" font-family="Arial" font-size="7" fill="white" font-weight="bold">REJECT</text>

  <!-- User approval -->
  <text x="135" y="445" text-anchor="middle" font-family="Arial" font-size="9" fill="#4caf50" font-weight="bold">‚úÖ User approves</text>

  <!-- Phase 4: Payment -->
  <rect x="150" y="465" width="380" height="95" rx="4" fill="#fce4ec" fill-opacity="0.3" stroke="#c2185b" stroke-dasharray="3,3"/>
  <text x="160" y="480" font-family="Arial" font-size="10" fill="#c2185b" font-weight="bold">‚ë£ PAYMENT EXECUTION</text>

  <!-- Step 7 -->
  <text x="270" y="498" text-anchor="middle" font-family="Arial" font-size="9" fill="#333">Auth token</text>
  <line x1="200" y1="505" x2="335" y2="505" stroke="#388e3c" stroke-width="2"/>
  <polygon points="330,501 340,505 330,509" fill="#388e3c"/>

  <!-- Step 8 -->
  <text x="410" y="523" text-anchor="middle" font-family="Arial" font-size="9" fill="#333">Process payment</text>
  <line x1="340" y1="530" x2="475" y2="530" stroke="#f57c00" stroke-width="2"/>
  <polygon points="470,526 480,530 470,534" fill="#f57c00"/>

  <!-- Step 9 -->
  <line x1="480" y1="548" x2="345" y2="548" stroke="#c2185b" stroke-width="2" stroke-dasharray="4,2"/>
  <polygon points="350,544 340,548 350,552" fill="#c2185b"/>
  <text x="410" y="545" text-anchor="middle" font-family="Arial" font-size="9" fill="#333">Confirmed</text>

  <!-- Final confirmation -->
  <rect x="20" y="575" width="510" height="40" rx="4" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
  <text x="275" y="600" text-anchor="middle" font-family="Arial" font-size="11" fill="#2e7d32" font-weight="bold">‚úàÔ∏è Booking Confirmed! Confirmation sent to user</text>
</svg>
